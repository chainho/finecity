##Interview Questions

###NetEase
1. 秒杀、抢红包等原理，实现
2. HashMap是如何处理**哈希冲突**的
3. 线程中，子线程访问主线程及传值回主线程的方式
4. HashMap和HashTable的区别除了线程安全方面，还有什么区别
5. 五台服务器、十种商品，如何保证秒杀。。。

### Ali

1. 假设数据库的字段包含A、B、C、D，应用请求时可能包含的查询类似于A=XX and B=XX，或者A=XX and D=XX 或者A=XX and B=xx and C=xx，这种情况下如何创建索引要好一些？ 

2. 不用类库求根号3 

3. 一个系统，平时处理一个请求2ms就可以处理完成，今天2s才处理完成，如果快速定位？ 

4. 分析一个线上的系统，不能停机，如何分析故障原因？ 

5. 假设现有一个系统，目前是十多台物理主机向一个中心节点发送数据，如果后期业务增长，有一万多台物理主机，此时系统如何设计能应对？ 

6. 就上一个问题，如果十个物理主机向中心发送数据，如何限制中心同时只需要处理5个请求的任务？ 


###秒杀问题
在ITEYE和ZHIHU上都部了类似的问题
> 近几年，各大电商甚至各个运营商，都经常搞一些秒杀活动、抢红包等。比如某月的11号10点，某品牌手机“1元秒杀”，限量100部。 
此时，必然在10点前后，网站的并发量会相当大。为了应对网站的高并发，我们可以使用应用服务器集群，负载均衡器会将请求分发到各个应用服务器，这样各个应用服务器的流量就会小很多。但由于集群时同一个应用部署在多个应用服务器上，此时，对于这个100部的限量，该如何保证不会卖多呢？ 
单节点的时候，我们可以在应用内部使用锁和计数器来保证，可以使用类似于JDK内部的CountDownLatch这些并发组件，我们可以在应用内部使用锁和计数器来保证，但在集群环境下，这个应用内的计数器就没有意义了。应用被分发到各个服务器，此时为了保证这个数据的正常，一般常用的手段有哪些呢？ 
比如我们可以让所有的Server访问同一个数据库，这样来限制，但此时数据库就会成为瓶颈。为了解决瓶颈问题而采用数据库集群的话，各个数据库之间如何保证数据的同步的呢？ 
另外，如果使用Redis等分布式缓存，这样的话，为了解决单点问题也必然会有多个分布式缓存存在。此时多个缓存节点间的数据如何保证？ 

下面把网友的回复记录下：
```
Memcached 
redis 
在分步式计数效果很不错 
我们在秒杀之类的，基本都不让请求怎么过数据库 
1、设置请求本地缓存 
2、使用squid之类的请求缓存 
3、web的服务器做本地缓存+分布式的缓存 
4、MQ异步处理数据持久化
http://zhenghong-xia.blog.163.com/blog/static/5562015620118815711860/
上面的url有解释，一般静态资源不走tomcat之类的web服务器处理，使用CDN加速

```

```
1.秒杀活动，一般做得简单点，大家访问的都是同样的界面，页面全部进行缓存，秒杀按钮一般等到时间到了，才点亮，才生成URL，防止提前通过URL 访问。 

2.秒杀一般请求数特别多，在秒杀开始之前，URL 不开放，页面有缓存，无论用户怎么刷新，也不会给服务器造成压力。 

3.秒杀一旦开始，会有很多请求出现，但是一般我们只允许比如前100个有效请求，这个100个请求进行订单处理，其他请求都进入缓存好的，秒杀结束页面。 

4.实际上我们仅仅对有效请求进行处理，这里的处理办法可以对请求加入队列，当数目达到100，就不在添加，然后可以依次从队列里面提取信息，处理我们需要的结果，不会出现超标的情况。 

5.对于数据库的设计，一般情况下，如果量比较少，可以用专门的服务器来处理有效订单，其实请求就不会太多，压力不会太大了。 

6.在你分布式集群里面，假设你有N台服务器，那么你可以规定每台服务器仅仅处理100/N g个订单，同时你也可以做一个全局计数器，利用分布式缓存框架。 

7.因此你说的数据库压力，以及分布式数据同步的问题，可以得到很好的解决。关于分布式集群之间的通讯这些，可以靠消息中间件，或者延缓等等各种手段处理。 

8.上面仅仅是个人想法， 提供一些参考，有问题请指出~。~
```

ZHIHU上的回复

```
* 队列加延迟出结果，你唯一的选择,或者学小米吧，黑白号，单机游戏，只有小部分白号的人才能完去抢，其它人就洗洗 睡吧
* 目前我只知道的方法只有控制Session一致。
* 


```
